# API 描述

## 请求方式

所有 API 都同时支持 GET 和 POST 两种请求方式，参数可通过 URL 参数、表单或 JSON 传入，后两者分别对应 Content-Type `application/x-www-form-urlencoded` 和 `application/json`。如果使用 JSON 传入，参数要放在根级别的 JSON 对象中，且参数的数据类型必须符合 API 列表中给出的每个参数所要求的数据类型，大致如下：

```json
{"user_id": 123456, "message": "hello"}
```

API 描述中没有给出默认值的参数均为必填项。

如果配置文件中填写了 token，则每次请求需要在请求头中加入验证头，如：

```http
GET /send_private_msg?user_id=123456&message=hello HTTP/1.1
Authorization: token kSLuTF2GC2Q4q4ugm3
```

`kSLuTF2GC2Q4q4ugm3` 换成你填写的 token。

## 响应说明

对于任何请求，如果请求方式不支持，状态码为 405；如果 token 不符合，状态码为 404；剩下的所有情况，只要成功连接上服务器，无论 API 是否存在、实际操作失败还是成功，状态码都是 200。

响应内容为 JSON 格式，基本结构如下：

```json
{
    "status": "ok",
    "data": {
        "id": 123456,
        "nickname": "滑稽"
    }
}
```

`status` 字段如果是 `ok` 则表示 API 存在、参数有效，并且已经调用了酷 Q 的对应函数，但由于酷 Q 的函数并没有明显的成功与否的反馈，不能确定是否真的操作成功（例如，如果传入的 QQ 号不是好友，实际上是无法成功发送消息的）；如果是 `failed` 则表示 API 不存在，或参数不正确。

`data` 字段为 API 返回数据的内容，对于发送消息、踢人等不需要返回数据的操作，这里为 null，对于获取群成员信息这类操作，这里为所获取的数据的对象，具体的数据内容将会在相应的 API 描述中给出。

后面的 API 描述中将只给出 `data` 字段的内容，放在「响应数据」标题下。

## API 列表

### `/get_login_info` 获取登录号信息

#### 参数

无

#### 响应数据

| 字段名        | 数据类型   | 说明    |
| ---------- | ------ | ----- |
| `user_id`  | number | QQ 号  |
| `nickname` | string | QQ 昵称 |

### `/send_private_msg` 发送私聊消息

#### 参数

| 字段名       | 数据类型   | 默认值  | 说明      |
| --------- | ------ | ---- | ------- |
| `user_id` | number | -    | 对方 QQ 号 |
| `message` | string | -    | 要发送的内容  |

#### 响应数据

无

### `/send_group_msg` 发送群消息

#### 参数

| 字段名        | 数据类型   | 默认值  | 说明     |
| ---------- | ------ | ---- | ------ |
| `group_id` | number | -    | 群号     |
| `message`  | string | -    | 要发送的内容 |

#### 响应数据

无

### `/send_discuss_msg` 发送讨论组消息

#### 参数

| 字段名          | 数据类型   | 默认值  | 说明                                |
| ------------ | ------ | ---- | --------------------------------- |
| `discuss_id` | number | -    | 讨论组 ID（正常情况下看不到，需要从讨论组消息上报的数据中获得） |
| `message`    | string | -    | 要发送的内容                            |

#### 响应数据

无

### `/send_like` 发送好友赞

注：不支持酷 Q Air。

#### 参数

| 字段名       | 数据类型   | 默认值  | 说明      |
| --------- | ------ | ---- | ------- |
| `user_id` | number | -    | 对方 QQ 号 |

#### 响应数据

无

### `/set_group_kick` 群组踢人

#### 参数

| 字段名                  | 数据类型   | 默认值     | 说明        |
| -------------------- | ------ | ------- | --------- |
| `group_id`           | number | -       | 群号        |
| `user_id`            | number | -       | 要踢的 QQ 号  |
| `reject_add_request` | bool   | `false` | 拒绝此人的加群请求 |

#### 响应数据

无

### `/set_group_ban` 群组单人禁言

#### 参数

| 字段名        | 数据类型   | 默认值       | 说明                |
| ---------- | ------ | --------- | ----------------- |
| `group_id` | number | -         | 群号                |
| `user_id`  | number | -         | 要禁言的 QQ 号         |
| `duration` | number | `30 * 60` | 禁言时长，单位秒，0 表示取消禁言 |

#### 响应数据

无

### `/set_group_anonymous_ban` 群组匿名用户禁言

#### 参数

| 字段名        | 数据类型   | 默认值       | 说明                            |
| ---------- | ------ | --------- | ----------------------------- |
| `group_id` | number | -         | 群号                            |
| `flag`     | string | -         | 要禁言的匿名用户的 flag（需从群消息上报的数据中获得） |
| `duration` | number | `30 * 60` | 禁言时长，单位秒，无法取消匿名用户禁言           |

#### 响应数据

无

### `/set_group_whole_ban` 群组全员禁言

#### 参数

| 字段名        | 数据类型   | 默认值    | 说明   |
| ---------- | ------ | ------ | ---- |
| `group_id` | number | -      | 群号   |
| `enable`   | bool   | `true` | 是否禁言 |

#### 响应数据

无

### `/set_group_admin` 群组设置管理员

#### 参数

| 字段名        | 数据类型   | 默认值    | 说明                 |
| ---------- | ------ | ------ | ------------------ |
| `group_id` | number | -      | 群号                 |
| `user_id`  | number | -      | 要设置管理员的 QQ 号       |
| `enable`   | bool   | `true` | true 为设置，false 为取消 |

#### 响应数据

无

### `/set_group_anonymous` 群组匿名

注：不支持酷 Q Air。

#### 参数

| 字段名        | 数据类型   | 默认值    | 说明       |
| ---------- | ------ | ------ | -------- |
| `group_id` | number | -      | 群号       |
| `enable`   | bool   | `true` | 是否允许匿名聊天 |

#### 响应数据

无

### `/set_group_card` 设置群名片（群备注）

#### 参数

| 字段名        | 数据类型   | 默认值  | 说明                   |
| ---------- | ------ | ---- | -------------------- |
| `group_id` | number | -    | 群号                   |
| `user_id`  | number | -    | 要设置的 QQ 号            |
| `card`     | string | 空    | 群名片内容，不填或空字符串表示删除群名片 |

#### 响应数据

无

### `/set_group_leave` 退出群组

#### 参数

| 字段名          | 数据类型   | 默认值     | 说明                              |
| ------------ | ------ | ------- | ------------------------------- |
| `group_id`   | number | -       | 群号                              |
| `is_dismiss` | bool   | `false` | 是否解散，如果登录号是群主，则仅在此项为 true 时能够解散 |

#### 响应数据

无

### `/set_group_special_title` 设置群组专属头衔

#### 参数

| 字段名             | 数据类型   | 默认值  | 说明                                       |
| --------------- | ------ | ---- | ---------------------------------------- |
| `group_id`      | number | -    | 群号                                       |
| `user_id`       | number | -    | 要设置的 QQ 号                                |
| `special_title` | string | 空    | 专属头衔，不填或空字符串表示删除专属头衔                     |
| `duration`      | number | `-1` | 专属头衔有效期，单位秒，-1 表示永久，不过此项似乎没有效果，可能是只有某些特殊的时间长度有效，有待测试 |

#### 响应数据

无

### `/set_discuss_leave` 退出讨论组

#### 参数

| 字段名          | 数据类型   | 默认值  | 说明                                |
| ------------ | ------ | ---- | --------------------------------- |
| `discuss_id` | number | -    | 讨论组 ID（正常情况下看不到，需要从讨论组消息上报的数据中获得） |

#### 响应数据

无

### `/set_friend_add_request` 处理加好友请求

#### 参数

| 字段名       | 数据类型   | 默认值    | 说明                      |
| --------- | ------ | ------ | ----------------------- |
| `flag`    | string | -      | 加好友请求的 flag（需从上报的数据中获得） |
| `approve` | bool   | `true` | 是否同意请求                  |
| `remark`  | string | 空      | 添加后的好友备注                |

#### 响应数据

无

### `/set_group_add_request` 处理加群请求／邀请

#### 参数

| 字段名       | 数据类型   | 默认值    | 说明                                       |
| --------- | ------ | ------ | ---------------------------------------- |
| `flag`    | string | -      | 加好友请求的 flag（需从上报的数据中获得）                  |
| `type`    | string | -      | `add` 或 `invite`，请求类型（需要和上报消息中的 `sub_type` 字段相符） |
| `approve` | bool   | `true` | 是否同意请求／邀请                                |
| `remark`  | string | 空      | 拒绝理由                                     |

#### 响应数据

无

### `/get_group_member_info` 获取群成员信息

#### 参数

| 字段名        | 数据类型   | 默认值     | 说明                        |
| ---------- | ------ | ------- | ------------------------- |
| `group_id` | number | -       | 群号                        |
| `user_id`  | number | -       | QQ 号（不可以是登录号）             |
| `no_cache` | bool   | `false` | 是否使用缓存（使用缓存可能更新不及时，但响应更快） |

#### 响应数据

| 字段名                 | 数据类型    | 说明                               |
| ------------------- | ------- | -------------------------------- |
| `group_id`          | number  | 群号                               |
| `user_id`           | number  | QQ 号                             |
| `nickname`          | string  | 昵称                               |
| `card`              | string  | 群名片／备注                           |
| `sex`               | string  | 性别，`male` 或 `female` 或 `unknown` |
| `age`               | number  | 年龄                               |
| `area`              | string  | 地区                               |
| `join_time`         | number  | 加群时间戳                            |
| `last_sent_time`    | number  | 最后发言时间戳                          |
| `level`             | string  | 成员等级                             |
| `role`              | string  | 角色，`owner` 或 `admin` 或 `member`  |
| `unfriendly`        | bool    | 是否不良记录成员（不确定）                    |
| `title`             | string  | 专属头衔                             |
| `title_expire_time` | number  | 专属头衔过期时间戳                        |
| `card_changeable`   | bool | 是否允许修改群名片（不确定）                   |

### `/get_stranger_info` 获取陌生人信息

#### 参数

| 字段名        | 数据类型   | 默认值     | 说明                        |
| ---------- | ------ | ------- | ------------------------- |
| `user_id`  | number | -       | QQ 号（不可以是登录号）             |
| `no_cache` | bool   | `false` | 是否使用缓存（使用缓存可能更新不及时，但响应更快） |

#### 响应数据

| 字段名        | 数据类型   | 说明                               |
| ---------- | ------ | -------------------------------- |
| `user_id`  | number | QQ 号                             |
| `nickname` | string | 昵称                               |
| `sex`      | string | 性别，`male` 或 `female` 或 `unknown` |
| `age`      | number | 年龄                               |
